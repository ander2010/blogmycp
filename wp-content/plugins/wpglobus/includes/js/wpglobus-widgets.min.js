!function(e){"use strict";if("undefined"!=typeof WPGlobusWidgets){var t={saveArbitraryTextOrHTML:!1,editor:{},languageBoxActive:!1,languageBoxTimeout:null,init:function(){t.addElements(),t.attachListeners(),t.arbitraryTextOrHTML()},wysiwygClean:function(){e(".wpglobus-dialog-field").each(function(t,i){var a=e(i).data("source-id");if(1==e("#"+a+"-tmce").size()){var o=e(i).next(".wpglobus_dialog_start");e(i).remove(),e(o).remove()}})},setupWidgetControl:function(i,a,o){var r=!1;if(e.each(t.editor,function(e,t){if(t.widgetName==i)return r=!0,!1}),!r){if(""==a.$el[0].id){e(d).attr("id");var d=a.$el[0].offsetParent;a.$el[0].id=e(d).attr("id")}var n="#"+a.$el[0].id+" #widget-"+i+"-text",l="#"+a.$el[0].id+" #widget-"+i+"-title";t.editor[o.id]={},t.editor[o.id].widgetName=i,t.editor[o.id].controls=a,t.editor[o.id].sourceTitleSelector=l,t.editor[o.id].titleSelector=null,t.editor[o.id].sourceSelector=n,t.editor[o.id].content=e(n).val(),t.editor[o.id].saveSelector="#"+a.$el[0].id+" #widget-"+i+"-savewidget",t.editor[o.id].languageSelector="#"+a.$el[0].id+" .wpglobus-current-language",t.editor[o.id].inWidgetTitleSelector="#"+a.$el[0].id+" .in-widget-title";var u=WPGlobusCore.TextFilter(t.editor[o.id].content,WPGlobusCoreData.default_language,"RETURN_EMPTY");e("#"+o.id).val(u);var g="",s="";e.each(WPGlobusCoreData.enabled_languages,function(e,t){g=(g='<a href="#" onclick="return false;" class="item" data-widget-id="{{widgetID}}" data-source="{{source}}" data-editor-id="{{editorID}}" data-language="{{language}}" data-widget-name="{{widgetName}}" style="text-align:center;"><span>{{item}}</span></a>').replace("{{language}}",t),g=g.replace("{{item}}",WPGlobusCoreData.en_language_name[t]),g=g.replace("{{widgetName}}",i),g=g.replace("{{widgetID}}",a.$el[0].id),g=g.replace("{{editorID}}",o.id),g=g.replace("{{source}}",n),s+=g});var c='<button style="z-index:200000;" type="button" id="'+o.id+'-wpglobus-button" data-widget-id="'+a.$el[0].id+'"class="wp-switch-editor switch-wpglobus-language wpglobus-icon-globe"><span class="wpglobus-current-language" data-language="en" style="">En</span></button><div class="wpglobus-language-box" style="position:absolute;top:0;left:0;display:none;z-index:200100;border:1px solid #9e9e9e;border-radius:3px;background-color:#fff;padding: 2px 5px;"><div style="display:flex;flex-direction:column;">'+s+"</div></div>";e("#"+a.$el[0].id+" .wp-editor-tabs").append(c),WPGlobusDialogApp.addElement({id:a.fields.title[0].id,style:"width:93%;"})&&(t.editor[o.id].titleSelector="#"+a.fields.title[0].id),t.arbitraryWidgetTitle(o.id)}},arbitraryWidgetTitle:function(i){var a=WPGlobusCore.TextFilter(e("#"+t.editor[i].controls.fields.title[0].id).val(),WPGlobusCoreData.language);e(t.editor[i].inWidgetTitleSelector).text(": "+a)},setBoxTimeout:function(){t.languageBoxTimeout=setTimeout(function(){t.languageBoxActive=!1,e(".wpglobus-language-box").css({display:"none"})},1e3)},arbitraryTextOrHTML:function(){function i(i){if(t.editor[i.target.id]){var a=e(t.editor[i.target.id].languageSelector).data("language"),o="";o=tinymce.get(i.target.id).isHidden()?e("#"+i.target.id).val():tinymce.get(i.target.id).getContent({format:"raw"}),t.editor[i.target.id].content=WPGlobusCore.getString(t.editor[i.target.id].content,o,a),e(t.editor[i.target.id].sourceSelector).val(t.editor[i.target.id].content)}}e(document).on("click",".switch-wpglobus-language",function(i){if(!t.languageBoxActive){t.languageBoxActive=!0;var a=e(this),o=a.data("widget-id"),r=a.position();r.top+=34,r.left+=10,e("#"+o+" .wpglobus-language-box").css({display:"block",top:r.top+"px",left:r.left+"px"}),t.setBoxTimeout()}}),e(document).on("mouseenter",".wpglobus-language-box",function(e){clearTimeout(t.languageBoxTimeout)}).on("mouseleave",".wpglobus-language-box",function(i){e(".wpglobus-language-box").css({display:"none"}),t.languageBoxActive=!1}),e(document).on("click",".wpglobus-language-box .item",function(i){var a=e(this),o=a.data("language"),r=a.data("widget-id"),d=a.data("editor-id");e("#"+r+" .wpglobus-current-language").text(o).data("language",o);var n=WPGlobusCore.TextFilter(t.editor[d].content,o,"RETURN_EMPTY");tinymce.get(d).setContent(n,{format:"raw"}),e("textarea#"+d).val(n)}),e(document).on("tinymce-editor-setup",function(i,a){e.each(wp.textWidgets.widgetControls,function(e,i){t.setupWidgetControl(e,i,a)})}),e(document).on("tinymce-editor-init",function(a,o){e(document).on("mouseenter",t.editor[o.id].saveSelector,function(i){e(t.editor[o.id].sourceTitleSelector).val(e(t.editor[o.id].titleSelector).val()),e(t.editor[o.id].sourceSelector).val(t.editor[o.id].content)}),e(document).on("click",t.editor[o.id].saveSelector,function(e){t.saveArbitraryTextOrHTML=o.id}),o.on("nodechange keyup",_.debounce(i,100)),e("#"+o.id).on("keyup",_.debounce(i,100))})},addElements:function(i,a){var o,r=[];r[0]='input[type="text"]',r[1]="textarea",void 0===i||"class"==i?(o=".widget-liquid-right .widget .widget-content",e.each(r,function(e,i){t.make_clone(o,i)})):"id"==i&&(o="#"+a+" .widget-content",e.each(r,function(e,i){t.make_clone(o,i)}))},make_clone:function(t,i){e(t+" "+i).each(function(t,a){var o,r,d,n,l=e(a),u=!1;if(void 0===(n=l.attr("id"))||-1!=n.indexOf("-number")||""==n)return!0;if(_.each(WPGlobusWidgets.disabledMask,function(e){if(-1!=n.indexOf(e))return u=!0,!1}),u)return!0;if(o=e("#"+n).clone(),e(l).addClass("wpglobus-dialog-field-source hidden"),r=l.attr("name"),e(o).attr("id","wpglobus-"+n),e(o).attr("name","wpglobus-"+r),e(o).attr("data-source-id",n),e(o).attr("class","wpglobus-dialog-field"),e(o).attr("style","width:90%;"),d=WPGlobusCore.TextFilter(e(l).val(),WPGlobusCoreData.language),e(o).val(d),e('<div style="width:20px;" data-type="control" data-source-type="" data-source-id="'+n+'" class="wpglobus-widgets wpglobus_dialog_start wpglobus_dialog_icon"></div>').insertAfter(l),e(o).insertAfter(l),'input[type="text"]'==i&&""!=d){var g=l.parents(".widget").attr("id");e("#"+g+" .in-widget-title").text(": "+d)}})},attachListeners:function(){e(document).ajaxComplete(function(i,a,o){if(-1!=o.data.indexOf("action=save-widget"))if(-1!=o.data.indexOf("delete_widget=1"));else{if(t.saveArbitraryTextOrHTML){var r=WPGlobusCore.TextFilter(t.editor[t.saveArbitraryTextOrHTML].content,e(t.editor[t.saveArbitraryTextOrHTML].languageSelector).data("language"),"RETURN_EMPTY");return tinymce.get(t.saveArbitraryTextOrHTML).isHidden()?(e("#"+t.saveArbitraryTextOrHTML).val(r),e("#"+t.saveArbitraryTextOrHTML+"-tmce").click()):tinymce.get(t.saveArbitraryTextOrHTML).setContent(r,{format:"raw"}),t.arbitraryWidgetTitle(t.saveArbitraryTextOrHTML),void(t.saveArbitraryTextOrHTML=!1)}var d=o.data.split("widget-id=");d=d[1].split("&"),e(".widget-liquid-right .widget").each(function(i,a){var o=e(a).attr("id");-1!==o.indexOf(d[0])&&(t.addElements("id",o),t.wysiwygClean())})}}),e("body").on("change",".wpglobus-dialog-field",function(){var t,i=e(this),a="#"+i.data("source-id"),o="",r="";void 0!==a&&(o=e(a).val(),/(\{:|\[:|<!--:)[a-z]{2}/.test(o)?(e.each(WPGlobusCoreData.enabled_languages,function(e,a){""!=(t=a==WPGlobusCoreData.language?i.val():WPGlobusCore.TextFilter(o,a,"RETURN_EMPTY"))&&(r+=WPGlobusCore.addLocaleMarks(t,a))}),e(a).val(r)):e(a).val(i.val()))}),e(document).on("click",".widget-title, .widget-title-action",function(e){e.preventDefault(),t.wysiwygClean()})}};WPGlobusWidgets=e.extend({},WPGlobusWidgets,t)}}(jQuery);